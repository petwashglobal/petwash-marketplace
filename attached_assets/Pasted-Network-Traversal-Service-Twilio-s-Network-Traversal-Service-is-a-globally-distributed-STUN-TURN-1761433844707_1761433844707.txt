Network Traversal Service




Twilio's Network Traversal Service is a globally distributed STUN/TURN service that helps you deploy more reliable WebRTC applications.

You can use this service in your WebRTC and VoIP applications for traversal and relay around NAT/firewalls, so that your users make a successful connection every time.

If you're new to STUN/TURN and ICE, check out the Frequently Asked Questions. If you want to start using Twilio's Network Traversal Service immediately, here's what you need to do.

Using Network Traversal Service in a WebRTC application





Using Network Traversal Service in a WebRTC application is as easy as requesting a token and passing it to your RTCPeerConnection constructor.

First, make a request from your web server to retrieve a Network Traversal Service Token and then pass it to your WebRTC application.


(warning)
Warning
You'll need to use your Twilio Account SID and Auth Token to get a Network Traversal Service Token. To keep your Twilio account credentials safe, you should only make this request from your server, not the client browser.
Generate NTS Token





Report code block


Copy code block
// Download the helper library from https://www.twilio.com/docs/node/install
const twilio = require("twilio"); // Or, for ESM: import twilio from "twilio";

// Find your Account SID and Auth Token at twilio.com/console
// and set the environment variables. See http://twil.io/secure
const accountSid = process.env.TWILIO_ACCOUNT_SID;
const authToken = process.env.TWILIO_AUTH_TOKEN;
const client = twilio(accountSid, authToken);

async function createToken() {
  const token = await client.tokens.create();

  console.log(token.accountSid);
}

createToken();
Response



Copy response
{
  "username": "dc2d2894d5a9023620c467b0e71cfa6a35457e6679785ed6ae9856fe5bdfa269",
  "ice_servers": [
    {
      "urls": "stun:global.stun.twilio.com:3478"
    },
    {
      "username": "dc2d2894d5a9023620c467b0e71cfa6a35457e6679785ed6ae9856fe5bdfa269",
      "credential": "tE2DajzSJwnsSbc123",
      "urls": "turn:global.turn.twilio.com:3478?transport=udp"
    },
    {
      "username": "dc2d2894d5a9023620c467b0e71cfa6a35457e6679785ed6ae9856fe5bdfa269",
      "credential": "tE2DajzSJwnsSbc123",
      "urls": "turn:global.turn.twilio.com:3478?transport=tcp"
    },
    {
      "username": "dc2d2894d5a9023620c467b0e71cfa6a35457e6679785ed6ae9856fe5bdfa269",
      "credential": "tE2DajzSJwnsSbc123",
      "urls": "turn:global.turn.twilio.com:443?transport=tcp"
    }
  ],
  "date_updated": "Fri, 01 May 2020 01:42:57 +0000",
  "account_sid": "ACXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
  "ttl": "86400",
  "date_created": "Fri, 01 May 2020 01:42:57 +0000",
  "password": "tE2DajzSJwnsSbc123"
}
Next, include the ice_servers property in the RTCConfiguration object you pass to the RTCPeerConnection constructor when setting up a call, as shown below. Here, ICE_SERVERS contains the contents of the ice_servers property returned in the response above:



Copy code block
// Here's an example in javaScript
myIceServers = ICE_SERVERS;
var configuration = { iceServers: myIceServers };
var pc = new RTCPeerConnection(configuration);
From this point, exchange SDP (Session Description Protocol) offer/answers as you normally would.

Well done! You've now used Network Traversal Service to set up a connection.

If the browser you're using supports Trickle ICE

, you'll also want to handle the RTCPeerConnection's onIceCandidate event to pass any new ICE candidates to the connected peer:



Copy code block
// Here's an example in javaScript
pc.onicecandidate = function (evt) {
  if (evt.candidate) {
    // Send the candidate to the other party via your signaling channel
  }
};
If you need more help, check out the FAQ. You can also contact Twilio Support through the Console

 or Help Center

.

Using Network Traversal Service with the Twilio Programmable Voice SDKs





The Programmable Voice SDKs allow you to add voice-over-IP (VoIP) calling directly into your web and native mobile applications. The Programmable Voice SDKs build on top of WebRTC and can leverage STUN and TURN to traverse restrictive networks. For a complete description of how to use the Network Traversal Service tokens with Programmable Voice SDKs, refer to the Programmable Voice SDK network connectivity requirements.

Using Network Traversal Service in a VoIP client






(warning)
Warning
In order to use Network Traversal Service in a VoIP client, you'll need to be able to make an HTTP request from your VoIP client or another application at least once every 24 hours to retrieve a new ephemeral token.
To use Network Traversal Service with a VoIP Client, follow these steps:

Retrieve a Network Traversal Service Token.
Extract the STUN and TURN URLs from the returned data, along with the username and credential values.
Configure your VoIP client with these values.
Network Traversal Service Tokens are good for up to one day, and that's their default value. You can lower the token expiration period by setting the Ttl parameter when you request the token. Find out more in the Network Traversal Service Token documentation.

